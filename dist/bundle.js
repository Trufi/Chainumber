!function e(t,n,i){function s(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(l)return l(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var r=n[o]={exports:{}};t[o][0].call(r.exports,function(e){var n=t[o][1][e];return s(n?n:e)},r,r.exports,e,t,n,i)}return n[o].exports}for(var l="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e){var t=e("./state.js"),n=e("./util.js");n.isMobile||n.addClass(document.body,"no-touch");var i=document.getElementById("game"),s=new t;i.appendChild(s.element),s.runMainMenu()},{"./state.js":12,"./util.js":13}],2:[function(e,t){function n(e,t,n){this.id=++o,this.field=n,this.config=n.config,this.x=e,this.y=t,this.value=null,this.element=null,this.width=500/this.config.field.size[0],this.height=500/this.config.field.size[1],this._setRandomValue(),this._createElement(),this._bindEvents()}var i=e("./colors.js"),s=e("../util.js"),l=[1,2,3,5,7,11,13],o=0;n.prototype._createElement=function(){var e=document.createElement("div");e.className="block",e.style.left=Math.floor(this.x*this.width)+"px",e.style.bottom=Math.floor(this.y*this.height)+"px";var t=document.createElement("div");t.className="block__inner",e.appendChild(t);var n=document.createElement("div");n.className="block__active",e.appendChild(n);var i=document.createElement("div");i.className="block__text",i.innerHTML=this.value,t.appendChild(i),this.innerElement=t,this.textElement=i,this.activeElement=n,this.element=e,this._updateColors()},n.prototype._setRandomValue=function(){var e=0,t=this.config.numbers.possibleValues;t.forEach(function(t){e+=t[1]});for(var n=0,i=t.map(function(t){var i=t[1]/e+n;return n+=i,i}),s=Math.random(),l=0,o=0;o<i.length;o++)if(s<=i[o]){l=t[o][0];break}this.value=l},n.prototype._bindEvents=function(){s.isMobile?s.on(this.element,"touchstart",this._mouseDownHandler.bind(this)):(s.on(this.element,"mousedown",this._mouseDownHandler.bind(this)),s.on(this.activeElement,"mouseover",this._mouseOverHandler.bind(this)))},n.prototype._mouseDownHandler=function(e){e.preventDefault(),this.field.blockMouseDown(this.id)},n.prototype._mouseOverHandler=function(){this.field.blockMouseOver(this.id)},n.prototype._mouseOutHandler=function(){this.field.blockMouseOut(this.id)},n.prototype.changePosition=function(e,t){this.x=e,this.y=t,this.element.style.left=Math.floor(e*this.width)+"px",this.element.style.bottom=Math.floor(t*this.height)+"px"},n.prototype._updateColors=function(){var e,t=[];for(e=l.length-1;e>0;e--)this.value%l[e]===0&&t.push({value:l[e],rgb:i[e].rgb,ratio:this.value/l[e]});var n;n=t.length?s.rgbSum(t):i[0].rgb,this.innerElement.style.backgroundColor="rgb("+n.join(",")+")"},n.prototype.changeValue=function(e){this.value=e,this.textElement.innerHTML=e,this._updateColors()},n.prototype.select=function(){s.addClass(this.element,"_selected")},n.prototype.unselect=function(){s.removeClass(this.element,"_selected")},n.prototype.animateCreate=function(){var e=this;s.addClass(this.element,"_blink"),setTimeout(function(){s.removeClass(e.element,"_blink")},0)},t.exports=n},{"../util.js":13,"./colors.js":3}],3:[function(e,t){t.exports=[{web:"#99b433",rgb:[154,180,51]},{web:"#DA532C",rgb:[218,83,44]},{web:"#1e7145",rgb:[30,113,69]},{web:"#2C89A0",rgb:[44,137,160]},{web:"#00AA88",rgb:[0,170,136]},{web:"#00d455",rgb:[0,212,85]},{web:"#ff2a2a",rgb:[255,42,42]},{web:"#CB5000",rgb:[203,80,0]}]},{}],4:[function(e,t){function n(e){this.game=e,this.config=e.config,this.blocks={},this._blocksXY={},this.size=this.config.field.size,this.selectedBlocks=[],this.selectedMode=!1,this.element=null,this._init(),this._createElement(),this._bindEvents()}var i=e("./block.js"),s=e("../util"),l=e("../gameConfig");n.prototype._init=function(){for(var e=0;e<this.size[0];e++){this._blocksXY[e]={};for(var t=0;t<this.size[1];t++)this.createBlock(e,t,!0)}},n.prototype.createBlock=function(e,t,n){var s=new i(e,t,this);this.blocks[s.id]=s,this._blocksXY[e][t]=s.id,n||(this.element.appendChild(s.element),s.animateCreate())},n.prototype._createElement=function(){var e=document.createDocumentFragment();this.canvas=document.createElement("canvas"),this.canvas.className="field__canvas",this.ctx=this.canvas.getContext("2d"),this.canvas.width=l.field.width,this.canvas.height=l.field.height,e.appendChild(this.canvas),s.forEach(this.blocks,function(t){e.appendChild(t.element)}),this.element=document.createElement("div"),this.element.className="field _width_"+this.size[0]+" _height_"+this.size[1],this.element.appendChild(e)},n.prototype._bindEvents=function(){s.isMobile?(s.on(document.body,"touchend",this._mouseUpHandler.bind(this)),s.on(document.body,"touchmove",this._touchMoveHandler.bind(this))):s.on(document.body,"mouseup",this._mouseUpHandler.bind(this))},n.prototype._touchMoveHandler=function(e){var t,n,i,s,l,o,a,c=this.blocks;for(o=0;o<e.changedTouches.length;o++)if(s=e.changedTouches[o],l=document.elementFromPoint(s.clientX,s.clientY),l&&-1!=l.className.indexOf("block__active")){for(i=Object.keys(c),a=0;a<i.length;a++)if(n=c[i[a]],n.activeElement===l){this.blockMouseOver(n.id),t=!0;break}if(t)break}},n.prototype._mouseUpHandler=function(){this.selectedMode&&(this.selectedMode=!1,this._runSelected(),s.forEach(this.blocks,function(e){e.unselect()}),this.game.updateChainSum(0),this._clearPath())},n.prototype.blockMouseDown=function(e){this.selectedMode=!0,this.selectedBlocks=[e],this.blocks[e].select(),this.game.updateChainSum(this._calcChainSum())},n.prototype._checkWithLast=function(e){var t=this.blocks[this.selectedBlocks[this.selectedBlocks.length-1]],n=this.blocks[e];return t.value==n.value&&Math.abs(t.x-n.x)<=1&&Math.abs(t.y-n.y)<=1},n.prototype.blockMouseOver=function(e){if(this.selectedMode){var t=this.selectedBlocks;if(-1==t.indexOf(e))this._checkWithLast(e)&&(t.push(e),this.blocks[e].select(),this.game.updateChainSum(this._calcChainSum()),this._updatePath());else if(t[t.length-2]==e){var n=t.pop();this.blocks[n].unselect(),this.game.updateChainSum(this._calcChainSum()),this._updatePath()}}},n.prototype._updatePath=function(){var e=this.ctx;this._clearPath(),e.beginPath(),e.strokeStyle=l.path.color,e.lineWidth=l.path.width,this.selectedBlocks.forEach(function(t,n){var i=this.blocks[t],s=(i.x+.5)*i.width,o=l.field.height-(i.y+.5)*i.height;0===n?e.moveTo(s,o):e.lineTo(s,o)},this),e.stroke()},n.prototype._clearPath=function(){this.ctx.clearRect(0,0,l.field.width,l.field.height)},n.prototype.blockMouseOut=function(){},n.prototype._calcChainSum=function(){var e=this.blocks[this.selectedBlocks[0]].value||0;return e*this.selectedBlocks.length},n.prototype._calcUpdateScore=function(){var e=this.blocks[this.selectedBlocks[0]].value,t=1+.2*(this.selectedBlocks.length-3);return Math.round(e*this.selectedBlocks.length*t)},n.prototype._blockRemove=function(e){var t=this.blocks[e];this.element.removeChild(t.element),this._blocksXY[t.x][t.y]=null,delete this.blocks[e]},n.prototype._runSelected=function(){if(!(this.selectedBlocks.length<this.config.chain.minLength)){this.game.updateScore(this._calcUpdateScore());var e=this.selectedBlocks.pop(),t=this.blocks[e],n=t.value*(this.selectedBlocks.length+1);t.changeValue(n),this.selectedBlocks.forEach(this._blockRemove,this),this._checkPositions()}},n.prototype._checkPositions=function(){var e=this,t=this._blocksXY,n=this.blocks;s.forEach(t,function(t){var i=[];s.forEach(t,function(e){e&&i.push(e)}),i.length!=e.size[1]&&i&&(i.sort(function(e,t){return n[e].y>n[t].y}),i.forEach(function(e,i){var s=n[e];s.y!=i&&(t[s.y]=null,s.changePosition(s.x,i),t[i]=e)}))}),this._addNewBlocks()},n.prototype._addNewBlocks=function(){for(var e=this._blocksXY,t=0;t<this.size[0];t++)for(var n=0;n<this.size[1];n++)e[t][n]||this.createBlock(t,n)},t.exports=n},{"../gameConfig":6,"../util":13,"./block.js":2}],5:[function(e,t){function n(e,t){this.name=e,this.state=t,this.config=config.levels[e],this.score=0,this._isWin=Boolean(-1!==t.winLevels.indexOf(e)),this.field=new i(this),this._createElement(),this._bindEvents()}var i=e("./field.js"),s=e("../util");n.prototype._createElement=function(){var e=document.createElement("div");e.className="game";var t=document.createElement("div");t.className="game__header",e.appendChild(t);var n=document.createElement("div");n.className="game__score",n.innerHTML="0",t.appendChild(n);var i=document.createElement("div");i.className="game__chainSum",t.appendChild(i);var l=document.createElement("div");l.className="game__goal",t.appendChild(l);var o=document.createElement("div");o.className="game__body",l.innerHTML="Goal: "+this.config.goal,e.appendChild(o),o.appendChild(this.field.element);var a=document.createElement("div");a.className="game__footer",e.appendChild(a);var c=document.createElement("div");c.className="game__backButton",c.innerHTML="Menu",a.appendChild(c);var h=document.createElement("div");h.className="game__restartButton",h.innerHTML="Restart",a.appendChild(h);var r=document.createElement("div");r.className="game__nextButton",r.innerHTML="Next",a.appendChild(r),this._isWin&&s.addClass(e,"_win"),this.backButton=c,this.restartButton=h,this.nextButton=r,this.scoreElement=n,this.chainSumElement=i,this.bodyElement=o,this.element=e},n.prototype._bindEvents=function(){s.on(this.restartButton,"click",this.restart.bind(this)),s.on(this.backButton,"click",this._backToMenu.bind(this)),s.on(this.nextButton,"click",this._nextLevel.bind(this))},n.prototype._nextLevel=function(){this.state.nextFromLevel()},n.prototype.restart=function(){var e=new i(this);this.bodyElement.replaceChild(e.element,this.field.element),this.score=0,this.scoreElement.innerHTML=0,this.field=e},n.prototype._backToMenu=function(){this.state.backFromLevel()},n.prototype.updateChainSum=function(e){e?(this.chainSumElement.innerHTML=e,s.addClass(this.chainSumElement,"_showed")):s.removeClass(this.chainSumElement,"_showed")},n.prototype.updateScore=function(e){this.score+=e,this.scoreElement.innerHTML=this.score,this._checkWin()},n.prototype._checkWin=function(){!this._isWin&&this.score>=this.config.winCondition.score&&(this._isWin=!0,this.state.levelWin(this.name),s.addClass(this.element,"_win"))},t.exports=n},{"../util":13,"./field.js":4}],6:[function(e,t){t.exports={field:{width:500,height:500},path:{color:"rgba(255, 255, 255, 0.25)",width:10},openLevelsLength:7,levels:[1,2,3,4,5,6,7,8]}},{}],7:[function(e,t){function n(e){this.state=e,this._levelBlocks={},this._createElement(),this._bindEvents()}var i=e("../gameConfig.js"),s=e("../util.js");n.prototype._createElement=function(){var e=this,t=document.createElement("div");t.className="levelMenu";var n=document.createElement("div");n.className="levelMenu__container",t.appendChild(n);var l=document.createElement("div");l.className="levelMenu__header",n.appendChild(l);var o=document.createElement("div");o.className="levelMenu__headerLevels",o.innerHTML="Levels:",l.appendChild(o);var a=document.createElement("div");a.className="levelMenu__body",n.appendChild(a);var c=document.createDocumentFragment();i.levels.forEach(function(t,n){var i=document.createElement("div");i.className="levelMenu__levelBlock _level_"+n%2,i.innerHTML=t,s.on(i,"click",function(){e.state.runLevel(t)}),e._levelBlocks[t]=i,c.appendChild(i)}),a.appendChild(c);var h=document.createElement("div");h.className="levelMenu__footer",n.appendChild(h);var r=document.createElement("div");r.className="levelMenu__backButton",r.innerHTML="Back",h.appendChild(r),this.backButton=r,this.element=t},n.prototype._bindEvents=function(){s.on(this.backButton,"click",function(){this.state.runMainMenu()}.bind(this))},n.prototype.updateOpenLevels=function(){this.state.openLevels.forEach(function(e){s.addClass(this._levelBlocks[e],"_open")},this)},t.exports=n},{"../gameConfig.js":6,"../util.js":13}],8:[function(e,t){t.exports={1:e("./levels/1"),2:e("./levels/2"),3:e("./levels/2"),4:e("./levels/2"),5:e("./levels/2"),6:e("./levels/2"),7:e("./levels/2"),8:e("./levels/2")}},{"./levels/1":9,"./levels/2":10}],9:[function(e,t){function n(e,t){i.call(this,e,t)}var i=e("../game/game.js");n.prototype=Object.create(i.prototype),n.prototype.constructor=n,t.exports=n},{"../game/game.js":5}],10:[function(e,t){var n=e("../game/game.js");t.exports=n},{"../game/game.js":5}],11:[function(e,t){function n(e){this.state=e,this._isResumeActive=!1,this._createElement(),this._bindEvents()}var i=e("../util.js");n.prototype._createElement=function(){var e=document.createElement("div");e.className="mainMenu",e.innerHTML='<div class="mainMenu__header"><div class="mainMenu__title">Chainumber</div></div><div class="mainMenu__body"><div class="mainMenu__newGame">New game</div><div class="mainMenu__resumeGame">Resume game</div></div><div class="mainMenu__footer"><div class="mainMenu__version">v0.0.1</div></div>',this.element=e,this.newGameButton=e.getElementsByClassName("mainMenu__newGame")[0],this.resumeGameButton=e.getElementsByClassName("mainMenu__resumeGame")[0]},n.prototype._bindEvents=function(){i.on(this.newGameButton,"click",function(){this.state.runLevelMenu()}.bind(this)),i.on(this.resumeGameButton,"click",function(){this.state.resumeLevel()}.bind(this))},n.prototype.resumeLevelActive=function(){this._isResumeActive||(this._isResumeActive=!0,i.addClass(this.element,"_activeLevel"))},t.exports=n},{"../util.js":13}],12:[function(e,t){function n(){this._activeElement=null,this._activeLevel=null,this.winLevels=[],this.openLevels=o.levels.slice(0,o.openLevelsLength),this.levelMenu=new i(this),this.mainMenu=new s(this),this._createElement(),this.levelMenu.updateOpenLevels()}var i=e("./levelMenu/levelMenu"),s=e("./mainMenu/mainMenu"),l=e("./levelModules"),o=e("./gameConfig.js"),a=e("./util");n.prototype._createElement=function(){this.element=document.createElement("div"),this.element.className="state",this.element.innerHTML='<div class="state__mainMenu"></div><div class="state__levelMenu"></div><div class="state__activeLevel"></div>',this.mainMenuElement=this.element.getElementsByClassName("state__mainMenu")[0],this.mainMenuElement.appendChild(this.mainMenu.element),this.levelMenuElement=this.element.getElementsByClassName("state__levelMenu")[0],this.levelMenuElement.appendChild(this.levelMenu.element),this.activeLevelElement=this.element.getElementsByClassName("state__activeLevel")[0]},n.prototype._activate=function(e){this._activeElement!==e&&(this._activeElement&&a.removeClass(this._activeElement,"_showed"),a.addClass(e,"_showed"),this._activeElement=e)},n.prototype.runLevelMenu=function(){this._activate(this.levelMenuElement)},n.prototype.runMainMenu=function(){this._activate(this.mainMenuElement)},n.prototype.runLevel=function(e){var t=-1!==this.openLevels.indexOf(e);if(t){this.mainMenu.resumeLevelActive();var n=new l[e](e,this);this._activeLevel?this.activeLevelElement.replaceChild(n.element,this._activeLevel.element):this.activeLevelElement.appendChild(n.element),this._activeLevel=n,this._activate(this.activeLevelElement)}},n.prototype.nextFromLevel=function(){var e=this.openLevels.indexOf(this._activeLevel.name),t=this.openLevels[e+1];t?this.runLevel(t):this.runLevelMenu()},n.prototype.levelWin=function(e){this.winLevels.push(e),this._openNextLevel()},n.prototype._openNextLevel=function(){var e=o.levels[this.openLevels.length];e&&this.openLevels.push(e),this.levelMenu.updateOpenLevels()},n.prototype.backFromLevel=function(){this.runMainMenu()},n.prototype.resumeLevel=function(){this._activeLevel&&this._activate(this.activeLevelElement)},t.exports=n},{"./gameConfig.js":6,"./levelMenu/levelMenu":7,"./levelModules":8,"./mainMenu/mainMenu":11,"./util":13}],13:[function(e,t){var n={};n.addClass=function(e,t){var n=e.className.split(" "),i=n.indexOf(t);return-1===i&&(n.push(t),e.className=n.join(" ")),e},n.removeClass=function(e,t){var n=e.className.split(" "),i=n.indexOf(t);return-1!==i&&(n.splice(i,1),e.className=n.join(" ")),e},n.hasClass=function(e,t){var n=e.className.split(" ");return-1!=n.indexOf(t)},n.forEach=function(e,t,n){e.length?e.forEach(t,n):Object.keys(e).forEach(function(i){t.call(n,e[i],i)})},n.on=function(e,t,n){e.addEventListener(t,n)},n.off=function(e,t,n){e.removeEventListener(t,n)};var i="DeviceOrientationEvent"in window||"orientation"in window;/Windows NT|Macintosh|Mac OS X|Linux/i.test(navigator.userAgent)&&(i=!1),/Mobile/i.test(navigator.userAgent)&&(i=!0),n.isMobile=i,n.rgbSum=function(e){var t,n,i,s=[0,0,0],l=0;for(n=0;n<e.length;n++){for(t=e[n],i=0;3>i;i++)s[i]+=t.rgb[i]*t.ratio;l+=t.ratio}for(i=0;3>i;i++)s[i]=Math.floor(s[i]/l);return s},n.nullFn=function(){},t.exports=n},{}]},{},[1]);